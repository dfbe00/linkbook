{% extends 'base.html' %}
{% load staticfiles %}
{% load i18n %}

{% block title %}{{link}}{% endblock %}

{% block body %}


    <div class="container">
        <div class="row">

            <div class="col s1 m3 l3"></div>
            <div class="col s10 m6 l6">
                <ul class="collection hoverable " style="border: 1px solid lightcoral">
                    <li class="collection-item avatar">
                      <i class="material-icons circle red">web</i>
                        <span class="title red-text">URL</span>
                        <p><a href = "{{link.url}}" target="_blank">{{link | linebreaksbr}} </a>  <button class="btn btn-flat red right waves-effect waves-light white-text" id="btn_url">Show url</button> </p>
                        <p id="url" style="display: none">{{ link.url }}</p>
                    </li>
                    <li class="collection-item avatar">
                      <i class="material-icons circle red">description</i>
                        <span class="title red-text">Description</span>
                       <p>{{link.description}}</p>
                    </li>
                    <li class="collection-item avatar">
                      <i class="material-icons circle red">assignment</i>
                        <span class="title red-text">Tags</span>
                        <p>
                        {% for tag in link.tags.all %}
                            <div class="chip">
                                {{tag.name}}
                            </div>
                         {% endfor %}
                        </p>
                    </li>

<li class="collection-item avatar">
    <div>
        <strong id="upvote_count">{{upvotes}}</strong>
        {% if request.user.is_authenticated %}
                <a class="btn-floating btn-medium waves-effect waves-light green" id = "upvote" link_id = "{{link.id}}">
                <i id = "upvote_icon" class="small material-icons {{upvote_button}}">thumb_up</i></a>
        {% endif %}
    </div>
    <div>
        <strong id="downvote_count">{{downvotes}}</strong>
        {% if request.user.is_authenticated %}
                <a class="btn-floating btn-medium waves-effect waves-light red" id = "downvote" link_id = "{{link.id}}">
                <i id = "downvote_icon" class="small material-icons {{downvote_button}}">thumb_down</i></a>
        {% endif %}
        </div>
</li>


                    <li class="collection-item avatar">
                      <i class="material-icons circle red">comment</i>
                        <span class="title red-text">Comments</span>
                        <p class="green-text">{{link.comment_set.count}} comment(s) on this link:</p>
                        <p>

                    {% for comment in link.comment_set.all %}
                        <div>
                            <span style="font-weight: 800">{{ comment.user }} <sub>[{{comment.date}}]</sub> :</span>
                            <span>{{ comment.text }}</span>
                        </div>
                    {% endfor %}
                        </p>
                    </li>

                <li class="collection-item avatar">
                      <i class="material-icons circle red">mode_comment</i>
                        <span class="title red-text">Write a comment</span>
                        <p>
                        <div>
                    <form method="post" action="/link/{{link.id}}/comment/" role="form">
                        {% csrf_token %}
                        <div class="input-field">
                        {{ comment_form.as_p }}
                        <button type="submit" class="save btn red waves-effect waves-light">Comment</button>
                    </form>
                    </div>
                        </p>
                    </li>
                </ul>


            </div>
            <div class="col s1 m3 l3"></div>
        </div>
    </div>

    <script>

    $(function () {

        var b = $('#btn_url');
        var disp = false;
        var URL = $('#url');
        b.click(function () {

            if(disp)
            {
                URL.css({'display' : 'none'});
                b.html("Show URL");
            }
            else
            {
                URL.css({'display' : 'block'});
                b.html("Hide URL");
            }
            disp = 1 - disp;
        });

    });

    $('#upvote').click(function(){
    var link_id;
    link_id = $(this).attr("link_id");
    $.get('/link/{{link.id}}/vote/', {type: 'U'}, function(data){

               $('#upvote_count').html(data['upvotes']);
               $('#downvote_count').html(data['downvotes']);
               $("#upvote_icon").toggleClass(data['upvote_button']);
               $("#downvote_icon").toggleClass(data['downvote_button']); 
        });
    });

    $('#downvote').click(function(){
    var link_id;
    link_id = $(this).attr("link_id");
    $.get('/link/{{link.id}}/vote/', {type: 'D'}, function(data){

               $('#downvote_count').html(data['downvotes']);
               $('#upvote_count').html(data['upvotes']);
               $("#upvote_icon").toggleClass(data['upvote_button']);
               $("#downvote_icon").toggleClass(data['downvote_button']); 
        });
    });

    </script>


{% endblock %}
