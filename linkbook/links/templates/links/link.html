{% extends 'base.html' %}
{% load staticfiles %}
{% load i18n %}

{% block title %}{{link}}{% endblock %}

{% block body %}
    <style>
    .btn
    {
        width: 100%;
        margin: 0px;
        padding: 0px;
    }
    p
    {
        margin: 0px;
        padding: 0px;
    }
    </style>
    <div class="container">
        <div class="row">
            <div class="col s1 m3 l3"></div>
            <div class="col s10 m6 l6">
                <ul class="collection hoverable " style="border: 1px solid #607d8b">
                    <li class="collection-item avatar">
                      <div class="row">
                        <!-- user avatar -->
                        <img class="responsive-img circle"  height = "40px" width="40px" src="{{link.user.profile.pic}}" />
                        &nbsp; &nbsp;
                        <span class="title blue-grey-text ">{{ link.user }} <sub>{{ link.date }}</sub></span> <br><span class="title blue-grey-text"><sup>&nbsp; &nbsp;&nbsp; Last updated : {{ link.last_updated }}</sup>  </span>
                      </div>
                        <div class="row" style="margin: 0px;">
                            <div class="col s12 m12 l12">
                                <i class="material-icons circle blue-grey">description</i>
                                <div>
                                    <div class="row" style="margin-bottom: 0px">
                                        <div class="col s7 m7 l7">
                                            <a href = "{{link.url}}" target="_blank" class="title center"> <h5>{{link.title | linebreaksbr}}</h5>
                                            </a>
                                        </div>
                                        <div class="col s1 m1 l1"></div>
                                        <div class="col s4 m4 l4 right-align" id="icons_extra">
                                                    <a class="btn-floating btn-small waves-effect waves-light blue" href="#modal10" title="Show URL"><i class="material-icons">remove_red_eye</i></a>

                                                    <a class="btn-floating btn-small  waves-effect waves-light blue" href="{{ link.url }}" title="Visit Link" target="_blank"><i class="material-icons">open_in_new</i></a>

                                                    <a class="btn-floating dropdown-button btn-small waves-effect waves-light blue" href="#" title="Share" data-beloworigin="true" data-activates="dropdown10"><i class="material-icons">share</i></a>

                                        </div>
                                    </div>
                                    <div id="modal10" class="modal">
                                            <div class="modal-content">
                                                <div class="row">
                                                    <div class="col s12 m7 l7">
                                                        <div class="title"><a id="link_url" href="{{ link.url }}" target="_blank"> {{ link.url }}</a>  </div>
                                                    </div>
                                                    <div class="col s12 m2 l2"></div>
                                                    <div class="col s12 m3 l3">
                                                       <button title="copy to clipboard" class="btn black white-text" id="copy"> <i class="material-icons black" style="color: white">content_copy</i></button>
                                                    </div>
                                                </div>

                                            </div>
                                          </div>

                                </div>
                                <hr>
                       <span class="title blue-grey-text">{{link.description}}</span>
                                <span id="url" style="display: none"><a href="{{ link.url }}" target="_blank"> {{ link.url }} </a></span>
                            </div>
                        </div>
                    </li>
                    <!-- Open Graph data -->
                    {% if show_og and og.title != None %}
                    <li class="collection-item avatar " style="padding: 4px">
                        <div class="card hoverable horizontal">
                            <div class="card-image" style="margin: 4px;" id="card_image_div">
                                <img src="{{og.image}}" class="responsive-image" height={{ og.image_height}} width={{ og.image_width }} id="card_image">
                            </div>

                            <div class="card-stacked">
                             {%if og.title != None %}
                                <div class="card-content" style="padding: 2px">
                                 <span><span style="font-weight: bolder">{{ og.title }}</span></span>
                                <p style="font-size: 80%">{{ og.description }}</p>
                                </div>
                                {% endif %}
                        </div>
                        </div>
                    </li>
                    {% endif %}
                    <!-- End of open graph data -->

                    <!-- Sharing Options
                    <li class="collection-item avatar">
                      <i class="material-icons circle blue-grey">share</i>
                        <span class="title blue-grey-text">Share</span>
                        <p>
                            <div>
                                <a href = "https://www.facebook.com/sharer/sharer.php?u={{link.url}}">
                                    <img height=41px width=41px src="/static/icons/fb.svg" alt="Facebook" />
                                </a>
                                <a href = "https://twitter.com/home?status={{link.url}}">
                                    <img height=41px width=41px src="/static/icons/Twitterbird.png" alt="Twitter" />
                                </a>
                                <a href = "https://plus.google.com/share?url={{link.url}}">
                                    <img height=41px width=41px src="/static/icons/gplus.png" alt="Google+" />
                                </a>
                                <a href = "http://www.reddit.com/submit?url={{link.url}}">
                                    <img height=41px width=41px src="/static/icons/reddit.png" alt="Reddit" />
                                </a>
                                <a href = "http://pinterest.com/pin/create/button/?url={{link.url}}&description={{link.description}}">
                                    <img height=41px width=41px src="/static/icons/pinterest.svg" alt="Pinterest" />
                                </a>
                                <a href = "https://www.linkedin.com/shareArticle?mini=true&url={{link.url}}">
                                    <img height=41px width=41px src="/static/icons/linkedin.svg" alt="LinkedIn" />
                                </a>
                            </div>
                        </p>
                    </li>
                    -->

                    <!-- Tags -->

                    <li class="collection-item avatar">
                      <i class="material-icons circle blue-grey">assignment</i>
                        <span class="title blue-grey-text">Tags</span>
                        <p>
                        {% for tag in link.tags.all %}
                            <div class="chip">
                                <a href = "/../tags/{{tag.name}}/" style="text-decoration: underline">{{tag.name}}</a>
                            </div></a>
                         {% endfor %}
                        </p>
                    </li>

                {% if request.user.is_authenticated %}
                    <li class="collection-item avatar">

                    <div class="row">
                        <div class="col s12 m4 l4">
                            <span> <sup id="upvotes_count">{{ upvotes }}</sup><sup> upvote(s)</sup></span>
                            <button class="btn green upvote upvote_upper_button waves-effect waves-light {{upvote_button}} center" id="upvote_button" link_id = "{{ link.id }}"> <i class="material-icons" style="color: white; background-color: transparent">thumb_up</i> </button>
                        </div>
                        <div class="col s12 m4 l4">
                            <span> <sup id="downvotes_count">{{ downvotes }} </sup><sup> downvote(s)</sup></span>
                                    <button title="downvote" class="btn waves-effect waves-light  red btn-block white-text downvote downvote_upper_button {{ downvote_button }}" id="downvote_button" link_id = "{{ link.id }}" > <i class="material-icons" style="color: white; background-color: transparent" >thumb_down</i></button>
                        </div>
                        <div class="col s12 m4 l4">
                            <span>
                                <sup>{{link.comment_set.count}} comment(s)</sup>
                            </span>
                            <button class="btn blue waves-light center waves-effect" id="comments_tab">Comments</button>
                        </div>
                    </div>
                    </li>
                {% endif %}

                <li class="collection-item avatar" id="comments" style="display: none">
                      <i class="material-icons circle blue-grey">comment</i>
                        <span class="title blue-grey-text">Comments</span>
                        <p class="green-text">{{link.comment_set.count}} comment(s) on this link:</p>
                        <p>

                    {% for comment in link.comment_set.all %}
                        <div>
                            <span style="font-weight: 800">{{ comment.user }} <sub>[{{comment.date}}]</sub> :</span>
                            <span>{{ comment.text }}</span>
                        </div>
                    {% endfor %}
                        </p>

                <form method="post" action="/link/{{link.id}}/comment/" role="form">
                        {% csrf_token %}
                        <div class="input-field">
                        {{ comment_form.as_p }}
                        <button type="submit" class="btn blue waves-effect waves-light">Comment</button>
                            </div>
                    </form>
                </li>
                </ul>
            </div>
            <div class="col s1 m3 l3"></div>
        </div>
    </div>

    <!--  Sharing dropdown -->
        <ul class="dropdown-content" id="dropdown10">
                                <li>
                                    <a href = "#"> Share Via
                                </a>
                                </li>
                                <li class="divider"></li>

                                <li><a href = "https://www.facebook.com/sharer/sharer.php?u={{link.url}}">
                                    <img height = 20px width = 20px src="/static/icons/fb.svg" alt="Facebook" /> | facebook
                                </a></li>

                                <li><a href = "https://twitter.com/home?status={{link.url}}">
                                    <img height = 20px width = 20px src="/static/icons/Twitterbird.png" alt="Twitter" />  | twitter
                                </a></li>
                                <li><a href = "https://plus.google.com/share?url={{link.url}}">
                                    <img height = 20px width = 20px src="/static/icons/gplus.png" alt="Google+" />  | google+
                                </a></li>
                                <li><a href = "http://www.reddit.com/submit?url={{link.url}}">
                                    <img height = 20px width = 20px src="/static/icons/reddit.png" alt="Reddit" />  | reddit
                                </a></li>

                               <li> <a href = "http://pinterest.com/pin/create/button/?url={{link.url}}&description={{link.description}}">
                                    <img height = 20px width = 20px src="/static/icons/pinterest.svg" alt="Pinterest" /> | pinterest
                                </a></li>

                                <li><a href = "https://www.linkedin.com/shareArticle?mini=true&url={{link.url}}">
                                    <img height = 20px width = 20px src="/static/icons/linkedin.svg" alt="LinkedIn" />  | linkedin
                                </a></li>


                    </ul>


    <!-- Copy to Clipboard Dropdown -->

    <ul id="dropdown11" class="dropdown-content">
            <li>
                <a id="link_url" href="{{ link.url }}" target="_blank"> {{ link.url }}
                 <i class="material-icons" id="copy">content_copy</i>
                </a>


        </li>
    </ul>



    <script>
    $(function () {

        $('.dropdown-button').dropdown({
      inDuration: 300,
      outDuration: 225,
      constrainWidth: false, // Does not change width of dropdown to that of the activator
      hover: false, // Activate on hover
      gutter: 0, // Spacing from edge
      belowOrigin: false, // Displays dropdown below the button
      alignment: 'right', // Displays dropdown with edge aligned to the left of button
      stopPropagation: false // Stops event propagation
    }
  );


        var b = $('#btn_url');
        var disp = false;
        var URL = $('#url');
        b.click(function () {
            if(disp)
            {
                URL.css({'display' : 'none'});
                b.html("Show URL");
            }
            else
            {
                URL.css({'display' : 'block'});
                b.html("Hide URL");
            }
            disp = 1 - disp;
        });
    $('.upvote_upper_button').click(function(){
    var link_id;
    link_id = $(this).attr("link_id");
    $.get('/link/{{link.id}}/vote/', {type: 'U'}, function(data){
               $('#upvotes_count').html(data['upvotes']);
               $('#downvotes_count').html(data['downvotes']);
               $('.upvote').removeClass('lighten-5');
               $('.downvote').removeClass('lighten-5');
               //$(".downvote").toggleClass(data['downvote_button']);
                console.log(data.upvote_button);
                console.log(data.downvote_button);
                if(data['upvote_button'] == '')
                {
                }
                else
                {
                    $('.upvote').addClass('lighten-5');
                }
        });
    });
    $('.downvote_upper_button').click(function(){
    var link_id;
    link_id = $(this).attr("link_id");
    $.get('/link/{{link.id}}/vote/', {type: 'D'}, function(data){
               $('#downvotes_count').html(data['downvotes']);
               $('#upvotes_count').html(data['upvotes']);
               $('.upvote').removeClass('lighten-5');
               $('.downvote').removeClass('lighten-5');
              // $(".downvote").addClass(data['downvote_button']);
                if(data['downvote_button'] == '')
                {
                }
                else
                {
                    $('.downvote').addClass('lighten-5');
                }
        });
    });
    var comments_tab = $('#comments_tab');
    var comments_open = 0;
    comments_tab.click(function () {
        if(comments_open == 0)
        {
            $('#comments').css({'display' : 'block'});
            comments_tab.html("Hide Comments");
        }
        else
        {
            $('#comments').css({'display' : 'none'});
            comments_tab.html("Comments");
        }
        comments_open = 1 - comments_open;
        });
        $('.modal').modal();
        var copy = $('#copy');
        copy.click(function () {
            var linkUrl = $('#link_url');
            copyToClipboard(linkUrl);
            Materialize.toast('copied to clipboard', 2000);
        });
    });
    $('img').on('error', function () {
        console.log("Hello");
        $('#card_image_div').css({'display' : 'none'});
    });
    function copyToClipboard(element) {
    var $temp = $("<input>");
    $("body").append($temp);
    $temp.val($(element).text()).select();
    document.execCommand("copy");
    $temp.remove();
}
    </script>

{% endblock %}